AZ-204 Study Guide

SECTION 01 - Implement Azure App Service web apps
	MODULE 01 -- Explore Azure App Services
		Unit 2 - https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-app-service/2-azure-app-service
		-- Examine Azure App Service
		
			An Azure App Service is an Http-based service for hosting web applications, REST APIs and mobile back ends developed using most major languages

			Pros
			- Auto Scale support built in
			- Scale up/down - increase number of cores or amount of RAM
			- Scale in/out- increase or decrease the number of machines that are running
			- Container support
			- CI/CD support
			
			Use App service Environment (ASE) for fully isolated and dedicated apps 

		Unit 3 - https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-app-service/3-azure-app-service-plans
		-- Examine Azure App Service Plans
		
			Every app runs in an App Service Plans
			Each plan defines:
				Operating System (Windows, Linux)
				Region (West US, East US, etc.)
				Number of VM instances
				Size of VM instances (Small, Medium, Large)
				Pricing tier (Free, Shared, Basic, Standard, Premium, PremiumV2, PremiumV3, Isolated, IsolatedV2)

			Pricing Tiers:
			Shared - Free and Shared
			Dedicated - Basic, Standard Premium PremiumV2 PremiumV3
			Isolated - Isolated and Isolated V2

			The App Service Plan is the "scale unit" of all contained apps
			All compute resources are grouped by App Service plan.
			 - apps run on all VMs in plan
			 - scaling occurs at this level and affects all apps in plan

		Unit 4 - https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-app-service/4-deploy-code-to-app-service
		-- Deploy to App Service
		
			Auto Deployment (CD)
			DevOps, GitHub, BitBucket

			Manual Deployment
			Git CLI .zip (S)FTP

			Deployment slots are avaliable with the Standard Tier or better

			Continuous deployment for container additional steps:
			- Build and tag image
			- Push tagged image to container registry
			- Update deployment slot with new image tag

			Sidecar containers allow extra services to be decoupled from container app 
			Ex. logging, monitoring, configuration and networking services

		Unit 5 - https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-app-service/5-authentication-authorization-app-service
		-- Authentication and Authorization

			App Service provides built in optional solutions
			Identity providers include
			- Microsoft Entra
			- Facebook
			- Google
			- X
			- OpenID connect
			- GitHub

			Use the provider SDK for browserless apps 
			Use provider SDK for most applications where user inputs credentials

			App Service provides a token store
			Logging and tracing collected directly to log files when enabled

		Unit 6 - https://learn.microsoft.com/en-us/training/modules/introduction-to-azure-app-service/6-network-features
		-- Discover App Service networking features

			Multi-tenant 
			Free Shared Basic Standard Premium PremiumV2 PremiumV3

			Single-tenant App Service Environment (ASE)
			Isolated 

			'Front-ends' - roles that handle incoming requests
			'Workers' - roles that host customer workloads

			Features handle application communication
			Inbound  features include:
			App-assigned address
			Access restrictions
			Service Endpoints
			Private Endpoints

			Outbound features include:
			Hybrid Connections
			Gateway-required virtual network integration
			Virtual network integration

		Assessment - 
		Q-Which App Service Plan provides the maximum scale-out capabilities?
		A-Isolated
	
	MODULE 2 - Configure Web App Settings
		Unit 2 - https://learn.microsoft.com/en-us/training/modules/configure-web-app-settings/2-configure-application-settings
		-- Configure Application Settings
		
			Application Settings are variables passed as environment variables to the application code-to-app-service
			Encryped at rest 
			Can only contain letters, letters, numbers and underscore
			Found in portal under Settings > Environment variables
			Connection strings can be set in Settings > Connection strings (used primarily for .NET/Core)
		
		Unit 3 - https://learn.microsoft.com/en-us/training/modules/configure-web-app-settings/3-configure-general-settings
		-- Configure general settings
		
			Found in Settings > Configuration > General settings
			- Stack Settings (including options startup command for linux and container apps)
			- Platform Settings
				- Bitness: 32 or 64 bit
				- FTP State: [dis]allow (S)FTP
				- WebSockets: ex:: SignalR or socket.io 
				- Always On
				- ARR affinity:
				- HTTPS Only:
				- Minimum TLS Version
			- Debugging
			- Incoming client certificates
			
		Unit 4 - https://learn.microsoft.com/en-us/training/modules/configure-web-app-settings/4-configure-path-mappings
		-- Configure Path Mappings
		
			Found in Settings > Configuration > Path mappings
			
			Configure for windows:
			- Extension: *.php or handler.fcgi
			- Script Processor - provide absolute path-mappings
			- Arguments - optional
			
			Configure for Linux and containers
			- Name: The display name.
			- Configuration options: Basic or Advanced. Select Basic if the storage account isn't using service endpoints, private endpoints, or Azure Key Vault. Otherwise, select Advanced.
			- Storage accounts: The storage account with the container you want.
			- Storage type: Azure Blobs or Azure Files. Windows container apps only support Azure Files. Azure Blobs only supports read-only access.
			- Storage container: For basic configuration, the container you want.
			- Share name: For advanced configuration, the file share name.
			- Access key: For advanced configuration, the access key.
			- Mount path: The absolute path in your container to mount the custom storage.
			- Deployment slot setting: When checked, the storage mount settings also apply to deployment slots.
		
		Unit 5 - https://learn.microsoft.com/en-us/training/modules/configure-web-app-settings/5-enable-diagnostic-logging
		-- Enable diagnostic logging

			App Service File System logging is for temporary debugging
			
			Azure Blob Storage is for long-term logging

			Types of logging:
				Application Logging 
				- Platform: Windows, Linux
				- Location: App Service File System and/or Azure Storage blobs
				- Description: Logs messges generated by application code	

				Web Server Logging:
				- Platform: Windows
				- Location: App Service File System and/or Azure Storage blobs
				- Description: Raw HTTP request data in the W3C extended log file format. Each log message includes data like the HTTP method, resource URI, client IP, client port, user agent, response code, and so on.

				Detailed error messages:
				- Platform: Windows
				- Location: App Service File
				- Description: Copies of the .html error pages that would otherwise be sent to the client browser for 400 or higher status codes

				Failed request tracing:
				- Platform: Windows
				- Location: App Service File
				- Description: Detailed tracing information on failed requests, including a trace of the IIS components used to process the request and the time taken in each component. Generated per failed request.

				Deployment logging:
				- Platform: Windows, Linux
				- Location: App Service File
				- Description: Copies of the .html error pages that would otherwise be sent to the client browser for 400 or higher status codes

			Application Logging Levels:
				- Disabled : none
				- Error: Error, Critical
				- Warning: Warning, Error, Critical
				- Information: Information, Warning, Error, Critical
				- Verbose: Trace, Debug, Info, Warning, Error, Critical (all)	

			Only FileSystem is available for logging in Linux/Container apps
				- Must specify Quota(MB) and Retention Period (Days)

			Access methods:
				- Stream to Azure Portal
				- Stream to Azure CLI
				- Stream to Local Console
				- Download zip file

		Unit 6 - https://learn.microsoft.com/en-us/training/modules/configure-web-app-settings/6-configure-security-certificates
		-- Configure Security Certificates

			Certificates are bound to a 'webspace' - the combination of the app service plan's resource group and its region

			Options to add a certificate to an App Service:
				Free App Service managed certificates
				- A private certificate that's free of charge and easy to use if you just need to secure your custom domain in App Service.

				Purchased App Service certificate
				- A private certificate managed by Azure. It combines the simplicity of automated certificate management and the flexibility of renewal and export options.

				Import a certificate from Key Vault
				- Useful if you use Azure Key Vault to manage your certificates.

				Upload a private certificate
				 - existing from third party vendor
				 
				Upload a public certificate
				- not used to secure domains, but available for accessing remote services

	MODULE 3 - Scale Apps in Azure App Services
		Unit 2 - https://learn.microsoft.com/en-us/training/modules/scale-apps-app-service/2-autoscale-factors
		-- Examine Scale out Options
		Autoscaling makes scaling decisions based on rules that you define.
			- makes scaling decisions based on defined rules
			- scales in/out (horizontal) as opposed to up/down (vertical)
			- useful when scaling for an expected (short term) spike in traffic that [will] occur during a known time period
			
		Automatic scaling makes scaling decisions for you based on the parameters that you select.
			- you dont want to set up rules
			- scale apps in the same App Service Plan independently
			- you want to limit the number of instances to avoid overwhelming a resource that may not scale as fast as the web application
		
		Autoscaling:
			Available Pricing Tiers: S1 and up
			Rule-based scaling: YES
			Schedule-based scaling: YES
			Always-ready instances: NO
			Rewarmed instances: NO
			Per-app maximum: NO (limited to app service plan instance limit ??)
		
		Automatic scaling:
			Available Pricing Tiers: P-level and up
			Rule-based scaling: NO - based on HTTP traffic
			Schedule-based scaling: NO
			Always-ready instances: YES (min 1)
			Rewarmed instances: YES(default 1)
			Per-app maximum: YES
			

		Unit 3 - https://learn.microsoft.com/en-us/training/modules/scale-apps-app-service/3-app-service-autoscale-conditions-rules
		-- Identify Autoscale Factors
		Autoscale conditions: (can be combined)
		- based on a metric
		- based on a schedule
		
		Autoscaling Metrics:
			- CPU Percentage
			- Memory Percentage
			- Disc Queue Length
			- Http Queue Length
			- Data In
			- Data Out
		
		time-grain: the frequency with which the metric values are evaluated
		time-grain-statistic: the aggregating operation that is used to calculate the time-aggregation. options include Average, Minimum, Maximum, Sum, Last, Count
		duration: (minimum of 5 min) the length of time that a metric is evaluated at the specified time-grain
		time-aggregation: the output value that is established to be used as a threshhold
		operator: the comparison operator used to determine if a threshhold has been crossed. (<, >, = etc)
		
		autoscale action: scale-out | scale-in
		
		Scale-Out actions are applied if ANY rules evalute to true
		Scale-In actions are applied only if ALL rules evaluate to true
		
		Unit 4 - https://learn.microsoft.com/en-us/training/modules/scale-apps-app-service/4-autoscale-app-service
		-- Enable Autoscale in App Service
		Monitoring: Scale out (App Service Plan) > Run History
		
		Unit 5 - https://learn.microsoft.com/en-us/training/modules/scale-apps-app-service/5-autoscale-best-practices
		-- Explore autoscale best practices
		
		Ensure the maximum and minimum values are different and have an adequate margin between them
		Choose the appropriate statistic for your diagnostics metric
		Choose the thresholds carefully for all metric types
		Always select a safe default instance count
		Configure autoscale notifications
	
	MODULE 4 - Explore Azure App Service Deployment Slots
		Unit 2 - https://learn.microsoft.com/en-us/training/modules/understand-app-service-deployment-slots/2-app-service-staging-environments
		- Explore Staging Environments
		Avaliable in Standard Tier or greater
		
		Benefits:
		- Pre-production release validation
		- Mitigates downtime by swapping into a pre-warmed production slot
		- allows for easy reverting in case of deployment failure
		
		Number of available slots is dictated by App Service Plan tier
		Site name is truncated to 40 characters
		Combined slot name and site name must be less than 59 charactes
		
		Unit 3 - https://learn.microsoft.com/en-us/training/modules/understand-app-service-deployment-slots/3-app-service-slot-swapping
		- Examine Slot Swapping
		
		6 step process:
		- Apply applicable settings from target slot (typically production) to the source slot
			- Slot specific app settings and connection strings, if appliable
			- Continuous deployment settings
			- Authentication settings
				* this triggers all instances to restart
				** if 'swap with preview' process pauses for validation
		- Await restart of all instances	
			- Abort process on any failure
		- Trigger local cache initialization (if enabled) with HTTP request to root ('/') for each instance
		- If applicationInitialization = true || N/A warm up each instance with http call to root
		- Once all instances are warmed up, swap the two slots by switching the routing rules
		- Apply all settings to new source (production backup) and restart
	
		Swappable settings (10)
		- General Settings (framework versions, bitness, web sockets)
		- App settings (can be configured to stick)
		- Connection strings (can be configured to stick)
		- Handler mappings
		- Public certificates
		- WebJobs content
		- Hybrid connections
		- Azure Content Delivery Network
		- Service endpoints
		- Path mappings
		
		Non swappable settings (12)
		- Publising endpoints
		- Custom domain names
		- Non public certificates and TLS/SSL settings
		- Scale settings
		- WebJobs scheduler
		- IP restrictions
		- Always On
		- Diagnostic Log Settings
		- CORS
		- Virtual network integration
		- Managed Identities
		- Settings that end with the suffix _EXTENSION_VERSION